# Backend API ???-????

## ? ????????? Endpoints

### 1. ??????????? ?????????? (????? - ??? push-???????????)
```
POST http://192.168.1.221:5132/devices/register
Content-Type: application/json

Request body:
{
  "token": "eF...",  // FCM ?????
  "platform": "Android"  // ??? "iOS", "Web"
}

Expected response (200 OK):
{
  "success": true,
  "message": "Device registered"
}
```

### 2. ???????? ??????????
```
POST http://192.168.1.221:5132/UploadAudio
Content-Type: multipart/form-data

FormData:
- file: <audio_file.m4a>

Expected response (200 OK):
{
  // ????? ???????? ?????
}
```

### 3. ????????? ?????? ???????
```
GET http://192.168.1.221:5132/GetRecordings
Accept: application/json

Expected response (200 OK):
[
  {
    "id": 1,
    "name": "recording_20240101_120000.m4a",
    "date": "2024-01-01T12:00:00Z"
  },
  ...
]
```

### 4. ?????????? ??????????
```
GET http://192.168.1.221:5132/DownloadAudio/{filename}

Parameters:
- filename: "recording_20240101_120000.m4a"

Expected response (200 OK):
- Content-Type: audio/mpeg ??? audio/m4a
- Binary audio file data
```

### 5. ???????? ??????????? ??????? (???????????)
```
GET http://192.168.1.221:5132/healthz/live

Expected response (200 OK):
{
  "status": "alive"  // ??? ????? ?????
}
```

---

## ?? ??? ?????????????? endpoints

### ????????? cURL (?? PowerShell):

#### 1. ????????? ??????
```powershell
curl -X GET "http://192.168.1.221:5132/healthz/live"
```

#### 2. ????????? ????
```powershell
$filePath = "C:\path\to\audio.m4a"
$form = @{
    file = Get-Item -Path $filePath
}
Invoke-RestMethod -Uri "http://192.168.1.221:5132/UploadAudio" `
    -Method Post -Form $form
```

#### 3. ???????? ?????? ???????
```powershell
curl -X GET "http://192.168.1.221:5132/GetRecordings" `
    -H "Accept: application/json"
```

#### 4. ???????????????? ??????????
```powershell
$body = @{
    token = "test_fcm_token_12345"
    platform = "Android"
} | ConvertTo-Json

curl -X POST "http://192.168.1.221:5132/devices/register" `
    -H "Content-Type: application/json" `
    -d $body
```

---

## ?? Backend Implementation Checklist

### ??????? endpoints (??? ?????? ????)
- [ ] `POST /UploadAudio` - ????????
- [ ] `GET /GetRecordings` - ?????????? JSON ?????? Recording
- [ ] `GET /DownloadAudio/{filename}` - ?????????? ???????? ??????

### ????? endpoints (??? push-???????????)
- [ ] `POST /devices/register` - ????????? FCM ????? ? ??
- [ ] [ OPTIONAL ] `GET /healthz/live` - ??? ???????? ???????????

### ?????? ??????
- [ ] ??? endpoints ?????????? ?????????? Content-Type headers
- [ ] ????????? CORS (???? frontend ? backend ?? ?????? ??????)
- [ ] ????????? ?????? ? ??????????? HTTP ?????????
- [ ] ??????????? ???????? ??? ???????

---

## ?? ???????? ???????? ? ???????

### ??????: "Cannot reach server"
```
Cause: Backend ?? ??????? ??? ???????????? IP
Solution: 
  1. ????????? backend ??????? ?? 192.168.1.221:5132
  2. ????????? ipconfig ?? ????? ??????????
  3. ??? Android Emulator ??????????? 10.0.2.2 ?????? 192.168.1.221
```

### ??????: "404 Not Found"
```
Cause: Endpoint ?? ??????????
Solution:
  1. ????????? ?????? ??? endpoint'? ? backend ????
  2. ????????? ??? ?? ??????????????? ??? route
  3. ????????? ???? backend'?
```

### ??????: "CORS error"
```
Cause: Frontend ? backend ?? ?????? ???????/??????
Solution:
  1. ???????? CORS middleware ?? backend
  [EnableCors("*")]
  public class UploadController : ControllerBase { }
  
  2. ??? ? Startup.cs:
  services.AddCors(options => {
      options.AddDefaultPolicy(builder => {
          builder.AllowAnyOrigin()
                 .AllowAnyMethod()
                 .AllowAnyHeader();
      });
  });
```

---

## ? ???????? ???????????? ???????? ???:

### ? ??????? ??????????:
```
[App] Initializing push notifications...
[Push] FCM Token obtained: cE...
[Push] Registering device with backend...
[Push] Device registered successfully
[Recordings] Fetching list...
[Recordings] Fetched: 5 items
[Playback] Starting download: recording_20240101_120000.m4a
[Playback] Playing: recording_20240101_120000.m4a
```

### ?? backend'?:
```
POST /devices/register - 200 OK
POST /UploadAudio - 200 OK
GET /GetRecordings - 200 OK
GET /DownloadAudio/recording_... - 200 OK
```

??????! ??????? ???????????? ? `npx expo start`
